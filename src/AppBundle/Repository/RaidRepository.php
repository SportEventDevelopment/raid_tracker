<?php

namespace AppBundle\Repository;

/**
 * RaidRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class RaidRepository extends \Doctrine\ORM\EntityRepository
{

    function findRaidsOrganisateursByIdUser($id_user)
    {
        $conn = $this->getEntityManager()->getConnection();
        $sql = "SELECT * FROM Raid r INNER JOIN Organisateur o WHERE o.idUser = :idUser AND r.id = o.idRaid";
        $stmt = $conn->prepare($sql);
        $stmt->execute(['idUser' => $id_user]);
        return $stmt->fetchAll();
    }

    function findRaidsBenevolesByIdUser($id_user)
    {
        $conn = $this->getEntityManager()->getConnection();
        $sql = "SELECT * FROM Raid r INNER JOIN Benevole b  WHERE  b.idUser = :idUser AND r.id = b.idRaid";
        $stmt = $conn->prepare($sql);
        $stmt->execute(['idUser' => $id_user]);
        return $stmt->fetchAll();
    }

    function findRaidsBenevolesChoisisByIdUser($id_user)
    {
        $conn = $this->getEntityManager()->getConnection();
        $sql = "SELECT * FROM Raid r INNER JOIN Benevole b WHERE
         b.est_benevole = true and b.idUser = :idUser AND r.id = b.idRaid";
        $stmt = $conn->prepare($sql);
        $stmt->execute(['idUser' => $id_user]);
        return $stmt->fetchAll();
    }

    function findAllRaids()
    {
        $conn = $this->getEntityManager()->getConnection();
        $sql = "SELECT * FROM Raid r";
        $stmt = $conn->prepare($sql);
        $stmt->execute();
        return $stmt->fetchAll();
    }

    function findAllParcoursByIdRaid($id_raid){
        $conn = $this->getEntityManager()->getConnection();
        $sql = "SELECT * FROM raid r inner join parcours p where r.id = idRaid and r.id = :idRaid";
        $stmt = $conn->prepare($sql);
        $stmt->execute(['idRaid' => $id_raid]);
        return $stmt->fetchAll();
    }

    function findPosteByIdRaid($id_raid)
    {

      $conn = $this->getEntityManager()->getConnection();
      $sql = "SELECT * FROM raid r inner join pref_poste p inner join poste po inner join user
      where
      po.id = p.poste_id and user.id = idUser and  r.id = idRaid and r.id = :idRaid";
      $stmt = $conn->prepare($sql);
      $stmt->execute(['idRaid' => $id_raid]);
      return $stmt->fetchAll();
    /*    $conn = $this->getEntityManager()->getConnection();
        $sql = "SELECT * FROM pref_poste p  WHERE p.idRaid = :idRaid ";
        $stmt = $conn->prepare($sql);
        return $stmt->fetchAll(); */
        $stmt->execute(['idRaid' => $id_raid]);
    }



}
